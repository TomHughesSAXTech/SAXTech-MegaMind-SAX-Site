<!DOCTYPE html>
<html>
<head>
    <title>Document Fetch Test</title>
</head>
<body>
    <h1>Document Fetch Speed Test</h1>
    <button onclick="testFastEndpoint()">Test Fast Endpoint</button>
    <button onclick="testFallbackEndpoint()">Test Fallback Endpoint</button>
    <button onclick="testBothEndpoints()">Test Both (with fallback logic)</button>
    <div id="results" style="margin-top: 20px; font-family: monospace;"></div>

    <script>
        const API_CONFIG = {
            baseUrl: 'https://saxtechmegamindfunctions.azurewebsites.net/api',
            functionKey: 'sZf5MvolOU8wqcM0sb1jI8XhICcOrTCfSIRl44vLmMAzSeA34CDO',
            endpoints: {
                search: '/documents/search'
            },
            fastDocumentList: {
                baseUrl: 'https://saxtech-document-list.azurewebsites.net/api',
                functionKey: 'Eiu7f0PsxmSfslsRuTRdOHVUIiCI__k6p7K4QMnPAg-VAzFuUNpb2A==',
                endpoint: '/list-documents'
            }
        };

        function log(message) {
            const results = document.getElementById('results');
            results.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }

        async function testFastEndpoint() {
            log('üöÄ Testing fast endpoint...');
            const startTime = performance.now();
            
            try {
                const url = `${API_CONFIG.fastDocumentList.baseUrl}${API_CONFIG.fastDocumentList.endpoint}?code=${API_CONFIG.fastDocumentList.functionKey}&limit=100`;
                const response = await fetch(url);
                const endTime = performance.now();
                
                log(`üìä Fast endpoint: Status ${response.status} in ${(endTime - startTime).toFixed(2)}ms`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Fast endpoint success: ${data.documents ? data.documents.length : 0} documents`);
                } else {
                    const text = await response.text();
                    log(`‚ùå Fast endpoint error: ${text.substring(0, 100)}`);
                }
            } catch (error) {
                const endTime = performance.now();
                log(`‚ùå Fast endpoint exception: ${error.message} (${(endTime - startTime).toFixed(2)}ms)`);
            }
        }

        async function testFallbackEndpoint() {
            log('üîç Testing fallback endpoint...');
            const startTime = performance.now();
            
            try {
                const response = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.search}?code=${API_CONFIG.functionKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: '*',
                        top: 50,
                        enableVector: false,
                        enableAI: false,
                        skipAnswer: true,
                        documentsOnly: true,
                        scoringParameter: 'document-boost'
                    })
                });
                const endTime = performance.now();
                
                log(`üìä Fallback endpoint: Status ${response.status} in ${(endTime - startTime).toFixed(2)}ms`);
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Fallback endpoint success: ${data.value ? data.value.length : 0} results, total count: ${data['@odata.count']}`);
                } else {
                    const text = await response.text();
                    log(`‚ùå Fallback endpoint error: ${text.substring(0, 100)}`);
                }
            } catch (error) {
                const endTime = performance.now();
                log(`‚ùå Fallback endpoint exception: ${error.message} (${(endTime - startTime).toFixed(2)}ms)`);
            }
        }

        async function testBothEndpoints() {
            log('üîÑ Testing both endpoints with fallback logic...');
            const startTime = performance.now();
            
            // Try fast endpoint first
            try {
                const fastUrl = `${API_CONFIG.fastDocumentList.baseUrl}${API_CONFIG.fastDocumentList.endpoint}?code=${API_CONFIG.fastDocumentList.functionKey}&limit=100`;
                const fastResponse = await fetch(fastUrl);
                
                if (fastResponse.ok) {
                    const data = await fastResponse.json();
                    if (data.success) {
                        const endTime = performance.now();
                        log(`‚úÖ Fast endpoint worked! ${data.documents.length} documents in ${(endTime - startTime).toFixed(2)}ms`);
                        return;
                    }
                }
            } catch (fastError) {
                log(`üîÑ Fast endpoint failed: ${fastError.message}`);
            }
            
            // Fallback to search endpoint
            try {
                log('üîç Falling back to search endpoint...');
                const fallbackResponse = await fetch(`${API_CONFIG.baseUrl}${API_CONFIG.endpoints.search}?code=${API_CONFIG.functionKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        query: '*',
                        top: 50,
                        enableVector: false,
                        enableAI: false,
                        skipAnswer: true,
                        documentsOnly: true,
                        scoringParameter: 'document-boost'
                    })
                });
                
                const endTime = performance.now();
                
                if (fallbackResponse.ok) {
                    const data = await fallbackResponse.json();
                    log(`‚úÖ Fallback successful! ${data.value ? data.value.length : 0} results in ${(endTime - startTime).toFixed(2)}ms`);
                } else {
                    log(`‚ùå Fallback failed with status ${fallbackResponse.status}`);
                }
            } catch (fallbackError) {
                const endTime = performance.now();
                log(`‚ùå Fallback exception: ${fallbackError.message} (${(endTime - startTime).toFixed(2)}ms)`);
            }
        }
    </script>
</body>
</html>